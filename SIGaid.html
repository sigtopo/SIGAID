<!DOCTYPE html>
<html lang="en" class=""><head><script>window.livecodes = window.livecodes || {};</script><title>SIGaid</title><meta name="title" content="SIGaid"><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"><style id="__livecodes_styles__"></style><script src="https://cdn.jsdelivr.net/npm/es-module-shims@1.10.0/dist/es-module-shims.js" async=""></script><script type="importmap">{
  "imports": {}
}</script></head><body>


  <meta charset="utf-8">
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ GeoJSON</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    html, body {
      height: 100%;
      margin: 0;
    }
    body {
      display: flex;
      flex-direction: column;
      font-family: sans-serif;
    }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± Ø¨ØªØ¯Ø±Ø¬ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø®Ø¶Ø± #00AA01 ÙˆØ§Ù„Ø£Ø¨ÙŠØ¶ */
    header {
      flex: 0 0 auto;
      height: 52px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding: 4px 12px;
      background: linear-gradient(90deg, #00AA01 0%, #ffffff 60%);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.15);
      z-index: 1000;
    }
    .header-logo {
      height: 36px; /* ØµØºÙŠØ± */
      width: auto;
    }

    /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© ØªØ´ØºÙ„ Ø¨Ù‚ÙŠØ© Ø§Ù„ØµÙØ­Ø© ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± */
    #map {
      flex: 1 1 auto;
      width: 100%;
    }

    .leaflet-popup-content table {
      border-collapse: collapse;
      font-size: 12px;
      direction: ltr;
    }
    .leaflet-popup-content th,
    .leaflet-popup-content td {
      border: 1px solid #ccc;
      padding: 2px 6px;
    }
    .leaflet-popup-content th { background-color: #f5f5f5; }

    /* Ã©tiquettes: Ù†Øµ Ø£Ø¨ÙŠØ¶ Ø¨Ø¸Ù„ Ø£Ø³ÙˆØ¯ */
    .feature-label {
      background: transparent;
      border: none;
      box-shadow: none;
      padding: 0;
      margin: 0;
      font-size: 11px;
      font-weight: bold;
      color: #fff;
      text-shadow:
        -1px -1px 0 #000,
         1px -1px 0 #000,
        -1px  1px 0 #000,
         1px  1px 0 #000;
    }

    /* ØªØ­ÙƒÙ… Ø§Ù„Ø®Ù„ÙÙŠØ§Øª (Ø£ÙŠÙ‚ÙˆÙ†Ø©) */
    .basemap-control {
      background: white;
      border-radius: 4px;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
      padding: 4px;
    }
    .basemap-toggle-btn {
      width: 28px;
      height: 28px;
      background: url('https://cdn-icons-png.flaticon.com/512/854/854929.png') center/20px 20px no-repeat;
      background-color: #fff;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .basemap-panel {
      margin-top: 4px;
      display: none;
      font-size: 12px;
      max-width: 180px;
    }
    .basemap-panel label {
      display: block;
      cursor: pointer;
      margin-bottom: 2px;
    }

    /* LÃ©gende */
    .legend-control {
      background: white;
      padding: 6px 8px;
      font-size: 12px;
      box-shadow: 0 0 4px rgba(0,0,0,0.3);
      border-radius: 4px;
      line-height: 18px;
    }
    .legend-title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    .legend-color {
      width: 16px;
      height: 16px;
      margin-right: 6px;
      border: 1px solid #555;
      flex-shrink: 0;
    }
    .legend-label {
      flex: 1;
    }
    .legend-item input[type="checkbox"] {
      margin-left: 6px;
    }

    /* Ø®Ø§Ù†Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¨Ø§Ù„ÙˆØ³Ø· */
    .search-control {
      background: white;
      padding: 5px 8px;
      border-radius: 20px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
      font-size: 13px;
      min-width: 220px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 6px;
      border: 1px solid #ddd;
    }
    .search-input {
      flex: 1;
      padding: 4px 8px;
      font-size: 13px;
      border: none;
      outline: none;
      border-radius: 20px;
    }
    .search-input::placeholder {
      color: #888;
      font-style: italic;
    }
    .search-icon-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #0078ff, #00b4ff);
      box-shadow: 0 1px 3px rgba(0,0,0,0.4);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 14px;
      padding: 0;
      flex-shrink: 0;
    }
    .search-icon-btn:active {
      transform: scale(0.95);
    }
    .search-suggestions {
      position: absolute;
      top: 36px;
      left: 0;
      right: 0;
      max-height: 180px;
      overflow-y: auto;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      z-index: 1000;
      display: none;
    }
    .search-suggestion-item {
      padding: 4px 8px;
      cursor: pointer;
      font-size: 12px;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
    .search-suggestion-item:hover {
      background: #f0f0f0;
    }
    .search-highlight {
      font-weight: bold;
      color: #0078ff;
    }

    /* Ø¬Ø¹Ù„ ØªØ­ÙƒÙ… Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ³Ø· ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± */
    .leaflet-top.leaflet-center {
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      pointer-events: none;
    }
    .leaflet-top.leaflet-center .leaflet-control {
      pointer-events: auto;
    }
  </style>


  <header>
    <img class="header-logo" src="https://aid-maroc.com/wp-content/uploads/2021/04/Logo-222.png" alt="Logo AID Maroc">
  </header>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    var map = L.map('map').setView([31.5, -7.5], 6);

    // Ø¥Ø¶Ø§ÙØ© Ø­Ø§ÙˆÙŠØ© top-center Ù„Ù„ØªØ­ÙƒÙ…Ø§Øª
    map._controlCorners['topcenter'] = L.DomUtil.create('div', 'leaflet-top leaflet-center', map._controlContainer);

    // Ø§Ù„Ø®Ù„ÙÙŠØ§Øª
    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    });

    var googleStreets = L.tileLayer(
      'https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains: ['mt0','mt1','mt2','mt3']
      }
    );

    var googleSat = L.tileLayer(
      'https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains: ['mt0','mt1','mt2','mt3']
      }
    );

    var googleHybrid = L.tileLayer(
      'https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}', {
        maxZoom: 20,
        subdomains: ['mt0','mt1','mt2','mt3']
      }
    );

    googleHybrid.addTo(map);

    function styleGabP1() { return { color: "#e41a1c", weight: 2, fillOpacity: 0.3 }; }
    function styleGabP2() { return { color: "#377eb8", weight: 2, fillOpacity: 0.3 }; }
    function styleBayada() { return { color: "#4daf4a", weight: 2, fillOpacity: 0.3 }; }
    function styleEnnasr() { return { color: "#984ea3", weight: 2, fillOpacity: 0.3 }; }

    var highlightStyle = {
      color: "#ffff00",
      fillColor: "#ffff00",
      weight: 3,
      fillOpacity: 0.4
    };

    var selectedFeature = null;
    var selectedOriginalStyle = null;
    var labelsEnabled = true;

    function getCurrentStyle(layer) {
      return {
        color: layer.options.color,
        weight: layer.options.weight,
        fillOpacity: layer.options.fillOpacity,
        fillColor: layer.options.fillColor || layer.options.color
      };
    }

    function onEachFeature(feature, layer) {
      var props = feature.properties || {};

      var html = "<table>";
      for (var key in props) {
        if (!props.hasOwnProperty(key)) continue;
        html += "<tr><th style='text-align:left;'>" + key + "</th><td>" + props[key] + "</td></tr>";
      }
      html += "</table>";
      layer.bindPopup(html);

      var label = props.Name || props.NAME || props.name;
      if (label) {
        layer.bindTooltip(label, {
          permanent: true,
          direction: "center",
          className: "feature-label"
        });
        if (!labelsEnabled) layer.closeTooltip();
      }

      layer.on('click', function (e) {
        if (selectedFeature && selectedOriginalStyle) {
          selectedFeature.setStyle(selectedOriginalStyle);
        }
        selectedFeature = e.target;
        selectedOriginalStyle = getCurrentStyle(e.target);

        e.target.setStyle(highlightStyle);
        e.target.bringToFront();

        if (e.target.getBounds) {
          map.fitBounds(e.target.getBounds(), { padding: [20, 20] });
        }
      });
    }

    var overlays = {
      "Gabgab P1": null,
      "Gabgab P2": null,
      "DÃ©limitation Bayada": null,
      "ENNASR": null
    };

    function addGeojson(url, name, styleFn) {
      fetch(url)
        .then(r => r.json())
        .then(data => {
          var layer = L.geoJSON(data, {
            style: styleFn,
            onEachFeature: onEachFeature
          });
          overlays[name] = layer;
          layer.addTo(map);

          if (Object.values(overlays).filter(l => l).length === 1) {
            map.fitBounds(layer.getBounds());
          }
        });
    }

    addGeojson("https://raw.githubusercontent.com/sigtopo/SIGAID/refs/heads/main/Gabgab%20P1.geojson", "Gabgab P1", styleGabP1);
    addGeojson("https://raw.githubusercontent.com/sigtopo/SIGAID/refs/heads/main/Gabgab%20P2.geojson", "Gabgab P2", styleGabP2);
    addGeojson("https://raw.githubusercontent.com/sigtopo/SIGAID/refs/heads/main/D%C3%A9limitation%20Bayada.geojson", "DÃ©limitation Bayada", styleBayada);
    addGeojson("https://raw.githubusercontent.com/sigtopo/SIGAID/refs/heads/main/ENNASR.geojson", "ENNASR", styleEnnasr);

    var baseMaps = {
      "OSM": osm,
      "Google Streets": googleStreets,
      "Google Satellite": googleSat,
      "Google Hybrid (Sat + Names)": googleHybrid
    };

    var BasemapControl = L.Control.extend({
      options: { position: 'topright' },
      onAdd: function (map) {
        var container = L.DomUtil.create('div', 'basemap-control');
        var button = L.DomUtil.create('button', 'basemap-toggle-btn', container);
        button.type = 'button';

        var panel = L.DomUtil.create('div', 'basemap-panel', container);

        L.DomEvent.disableClickPropagation(container);
        L.DomEvent.disableScrollPropagation(container);

        var first = true;
        for (var name in baseMaps) {
          (function (name) {
            var label = L.DomUtil.create('label', '', panel);
            var input = L.DomUtil.create('input', '', label);
            input.type = 'radio';
            input.name = 'basemap';
            input.value = name;

            if (first && map.hasLayer(baseMaps[name])) {
              input.checked = true;
              first = false;
            } else if (map.hasLayer(baseMaps[name])) {
              input.checked = true;
            }
            label.appendChild(document.createTextNode(' ' + name));

            input.addEventListener('change', function () {
              for (var key in baseMaps) {
                if (map.hasLayer(baseMaps[key])) map.removeLayer(baseMaps[key]);
              }
              baseMaps[name].addTo(map);
            });
          })(name);
        }

        button.onclick = function () {
          panel.style.display =
            (panel.style.display === 'none' || panel.style.display === '') ? 'block' : 'none';
        };

        return container;
      }
    });
    map.addControl(new BasemapControl());

    var LegendControl = L.Control.extend({
      options: { position: 'bottomright' },
      onAdd: function (map) {
        var container = L.DomUtil.create('div', 'legend-control');
        container.innerHTML = '<div class="legend-title">LÃ©gende</div>';

        L.DomEvent.disableClickPropagation(container);
        L.DomEvent.disableScrollPropagation(container);

        var items = [
          { name: "DÃ©limitation Bayada", color: "#4daf4a" },
          { name: "Gabgab P1", color: "#e41a1c" },
          { name: "Gabgab P2", color: "#377eb8" },
          { name: "ENNASR", color: "#984ea3" }
        ];

        items.forEach(function (item) {
          var row = L.DomUtil.create('div', 'legend-item', container);

          var colorBox = L.DomUtil.create('div', 'legend-color', row);
          colorBox.style.backgroundColor = item.color;

          var label = L.DomUtil.create('span', 'legend-label', row);
          label.textContent = item.name;

          var checkbox = L.DomUtil.create('input', '', row);
          checkbox.type = 'checkbox';
          checkbox.checked = true;

          checkbox.addEventListener('change', function () {
            var layer = overlays[item.name];
            if (!layer) return;
            if (checkbox.checked) {
              if (!map.hasLayer(layer)) map.addLayer(layer);
            } else {
              if (map.hasLayer(layer)) map.removeLayer(layer);
            }
          });
        });

        var rowLabels = L.DomUtil.create('div', 'legend-item', container);

        var colorBoxLbl = L.DomUtil.create('div', 'legend-color', rowLabels);
        colorBoxLbl.style.backgroundColor = "#ffffff";
        colorBoxLbl.style.border = "1px solid #000";

        var labelLbl = L.DomUtil.create('span', 'legend-label', rowLabels);
        labelLbl.textContent = "Ã©tiquettes";

        var checkboxLbl = L.DomUtil.create('input', '', rowLabels);
        checkboxLbl.type = 'checkbox';
        checkboxLbl.checked = true;

        checkboxLbl.addEventListener('change', function () {
          labelsEnabled = checkboxLbl.checked;
          Object.values(overlays).forEach(function (layer) {
            if (!layer) return;
            layer.eachLayer(function (fLayer) {
              if (!fLayer.getTooltip()) return;
              if (labelsEnabled && map.getZoom() >= labelMinZoom) {
                fLayer.openTooltip();
              } else {
                fLayer.closeTooltip();
              }
            });
          });
        });

        return container;
      }
    });
    map.addControl(new LegendControl());

    var labelMinZoom = 14;
    map.on('zoomend', function () {
      var z = map.getZoom();
      var showLabelsByZoom = z >= labelMinZoom;

      Object.values(overlays).forEach(function (layer) {
        if (!layer) return;
        layer.eachLayer(function (fLayer) {
          if (!fLayer.getTooltip()) return;
          if (showLabelsByZoom && labelsEnabled) {
            fLayer.openTooltip();
          } else {
            fLayer.closeTooltip();
          }
        });
      });
    });

    var SearchControl = L.Control.extend({
      options: { position: 'topcenter' },

      onAdd: function (map) {
        var container = L.DomUtil.create('div', 'search-control');

        var input = L.DomUtil.create('input', 'search-input', container);
        input.type = 'text';
        input.placeholder = 'Nom Ã©leveur..';

        var button = L.DomUtil.create('button', 'search-icon-btn', container);
        button.type = 'button';
        button.innerHTML = 'ğŸ”';

        var suggestions = L.DomUtil.create('div', 'search-suggestions', container);

        L.DomEvent.disableClickPropagation(container);
        L.DomEvent.disableScrollPropagation(container);

        function clearSuggestions() {
          suggestions.innerHTML = '';
          suggestions.style.display = 'none';
        }

        function highlightMatch(text, query) {
          var regex = new RegExp('(' + query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + ')', 'ig');
          return text.replace(regex, '<span class="search-highlight">$1</span>');
        }

        function zoomToFeature(fLayer) {
          if (selectedFeature && selectedOriginalStyle) {
            selectedFeature.setStyle(selectedOriginalStyle);
          }
          selectedFeature = fLayer;
          selectedOriginalStyle = getCurrentStyle(fLayer);

          fLayer.setStyle(highlightStyle);
          fLayer.bringToFront();

          if (fLayer.getBounds) {
            map.fitBounds(fLayer.getBounds(), { padding: [20, 20] });
          }
          if (fLayer.getPopup()) {
            fLayer.openPopup();
          }
        }

        function searchByName(query) {
          query = query.trim().toLowerCase();
          if (!query || query.length < 1) {
            clearSuggestions();
            return;
          }

          var results = [];

          Object.values(overlays).forEach(function (layer) {
            if (!layer) return;
            layer.eachLayer(function (fLayer) {
              var p = fLayer.feature && fLayer.feature.properties;
              if (!p) return;
              var name = (p.Name || p.NAME || p.name || '').toString();
              var lower = name.toLowerCase();
              if (lower.indexOf(query) !== -1 && name) {
                results.push({ name: name, layer: fLayer });
              }
            });
          });

          var seen = {};
          results = results.filter(function (r) {
            if (seen[r.name]) return false;
            seen[r.name] = true;
            return true;
          });

          clearSuggestions();
          if (results.length === 0) return;

          results.slice(0, 10).forEach(function (r) {
            var item = L.DomUtil.create('div', 'search-suggestion-item', suggestions);
            item.innerHTML = highlightMatch(r.name, query);
            item.onclick = function () {
              zoomToFeature(r.layer);
              clearSuggestions();
            };
          });

          suggestions.style.display = 'block';
        }

        input.addEventListener('input', function () {
          searchByName(input.value);
        });

        button.onclick = function () {
          searchByName(input.value);
        };

        input.addEventListener('blur', function () {
          setTimeout(clearSuggestions, 200);
        });

        return container;
      }
    });
    map.addControl(new SearchControl());
  </script>


<script></script></body></html>